#!/bin/sh
# Script for creating install.sh from install.sh.in
# By Serge van den Boom, 2002-11-26

if [ $# -ne 4 ]; then
	echo "Usage: mkinstall <attachment> <contentfiles> <licence>"
	echo "'attachment' is the .tgz file to attach to the script."
	echo "contentfiles is a space-seperated list of possible content files."
	exit 1
fi

OUTFILE="$1"
ATTACHMENT="$2"
CONTENT_FILES="$3"
LICENSE="$4"
case "$0" in
	*/*) EXECDIR="${0%/*}/" ;;
	*) EXECDIR="" ;;
esac
INFILE="${EXECDIR}install.sh.in"

# A slow way, but a reliable way.
ATTACHLEN=`wc -c < $ATTACHMENT`

#ATTACHLEN="$(du -b $ATTACHMENT | cut -f 1)"

# Very ugly, but I can't get sed to replace a pattern by the contents
# of a file.
FILEDATA="$(cat $INFILE)"
LICENSE_TEXT="$(cat $LICENSE)"
sed -e "s/@ATTACHLEN@/$ATTACHLEN/" \
		-e "s/@CONTENT_FILES@/$CONTENT_FILES/" > "$OUTFILE" << EOF
${FILEDATA/@LICENCE@/$LICENSE_TEXT}
EOF

#sed -e "s/@ATTACHLEN@/$ATTACHLEN/" \
#		-e "s/@CONTENT_FILES@/$CONTENT_FILES/" \
#		-e "s/@LICENSE@/$LICENSE_TEXT/" \
#		< "$INFILE" > "$OUTFILE"

cat "$ATTACHMENT" >> "$OUTFILE"


